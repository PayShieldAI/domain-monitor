openapi: 3.0.3
info:
  title: Domain Monitor API - Merchant Portal
  description: |
    Merchant-focused API for domain monitoring and verification.

    ## Overview
    This API allows merchants to monitor their domain reputation and verification status.
    All endpoints use JWT Bearer token authentication - no API keys required.

    ## Authentication
    All endpoints (except login and registration) require JWT authentication.

    ```
    Authorization: Bearer <your_access_token>
    ```

    Get your token by calling `/api/v1/auth/login` with your merchant credentials.

    ## Quick Start

    ### 1. Login
    ```bash
    curl -X POST https://your-domain.com/api/v1/auth/login \
      -H "Content-Type: application/json" \
      -d '{
        "email": "merchant@example.com",
        "password": "YourSecurePassword123"
      }'
    ```

    ### 2. Access Your Domains
    ```bash
    curl -X GET https://your-domain.com/api/v1/domains \
      -H "Authorization: Bearer <your_access_token>"
    ```

    ### 3. Add a Domain
    ```bash
    curl -X POST https://your-domain.com/api/v1/domains \
      -H "Authorization: Bearer <your_access_token>" \
      -H "Content-Type: application/json" \
      -d '{
        "domain": "example.com",
        "name": "Example Domain",
        "checkFrequency": "daily"
      }'
    ```

  version: 1.0.0
  contact:
    email: support@domainmonitor.com

servers:
  - url: https://dev-domainmonitor.ipo-servers.net
    description: Development server
  - url: https://api.domainmonitor.com
    description: Production server

tags:
  - name: Authentication
    description: Login and token management
  - name: Domains
    description: Domain monitoring and management
  - name: User Webhooks
    description: Register webhooks to receive domain event notifications

paths:
  # ==========================================
  # AUTHENTICATION
  # ==========================================
  /api/v1/auth/login:
    post:
      tags:
        - Authentication
      summary: Merchant login
      description: Authenticate and receive JWT access and refresh tokens
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: merchant@example.com
                password:
                  type: string
                  format: password
                  example: SecurePassword123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                        description: JWT access token (valid for 15 minutes)
                      refreshToken:
                        type: string
                        description: JWT refresh token (valid for 7 days)
                      expiresIn:
                        type: integer
                        example: 900
                        description: Token expiry in seconds
                      user:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          email:
                            type: string
                          name:
                            type: string
                          role:
                            type: string
                            enum: [merchant, reseller]
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '400':
          $ref: '#/components/responses/ValidationError'

  /api/v1/auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get a new access token using a refresh token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  description: The refresh token received during login
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Token refreshed
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                      expiresIn:
                        type: integer
                        example: 900
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout
      description: Revoke all refresh tokens for the current user
      operationId: logout
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logout successful
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/auth/change-password:
    post:
      tags:
        - Authentication
      summary: Change password
      description: Change the current user's password
      operationId: changePassword
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                  format: password
                newPassword:
                  type: string
                  format: password
                  minLength: 8
                  description: Must be at least 8 characters
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password changed successfully
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # ==========================================
  # DOMAINS
  # ==========================================
  /api/v1/domains:
    get:
      tags:
        - Domains
      summary: List all domains
      description: Get a list of all domains belonging to the authenticated merchant
      operationId: listDomains
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive]
          description: Filter by domain status
        - name: recommendation
          in: query
          schema:
            type: string
            enum: [pass, fail, review]
          description: Filter by recommendation status
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Domains retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Domains retrieved successfully
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Domain'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Domains
      summary: Add a new domain
      description: Register a new domain for monitoring
      operationId: createDomain
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - domain
              properties:
                domain:
                  type: string
                  example: example.com
                  description: Domain name without protocol
                name:
                  type: string
                  example: My Business Website
                  description: Friendly name for the domain
                checkFrequency:
                  type: string
                  enum: [daily, weekly, monthly]
                  default: daily
                  description: How often to check the domain
      responses:
        '201':
          description: Domain created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Domain created and verification initiated
                  data:
                    $ref: '#/components/schemas/Domain'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '409':
          description: Domain already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/domains/{id}:
    get:
      tags:
        - Domains
      summary: Get domain by ID
      description: Retrieve detailed information about a specific domain
      operationId: getDomainById
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Domain retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Domain'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/domains/{id}/details:
    get:
      tags:
        - Domains
      summary: Get domain verification details
      description: Get comprehensive verification details from the provider
      operationId: getDomainDetails
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Domain details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      domain:
                        $ref: '#/components/schemas/Domain'
                      verificationData:
                        type: object
                        description: Provider-specific verification data
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/domains/{id}/history:
    get:
      tags:
        - Domains
      summary: Get domain check history
      description: Retrieve historical check results for a domain
      operationId: getDomainHistory
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            default: 30
      responses:
        '200':
          description: History retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        recommendation:
                          type: string
                          enum: [pass, fail, review]
                        provider:
                          type: string
                        checkedAt:
                          type: string
                          format: date-time
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/domains/{id}/stop:
    patch:
      tags:
        - Domains
      summary: Stop monitoring domain
      description: Pause monitoring for this domain
      operationId: stopDomain
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Domain monitoring stopped
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Domain monitoring stopped
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/domains/{id}/start:
    patch:
      tags:
        - Domains
      summary: Start monitoring domain
      description: Resume monitoring for this domain
      operationId: startDomain
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Domain monitoring started
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Domain monitoring started
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/domains/bulk:
    post:
      tags:
        - Domains
      summary: Bulk add domains
      description: Add multiple domains at once
      operationId: bulkCreateDomains
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - domains
              properties:
                domains:
                  type: array
                  maxItems: 100
                  items:
                    type: object
                    required:
                      - domain
                    properties:
                      domain:
                        type: string
                        example: example.com
                      name:
                        type: string
                      checkFrequency:
                        type: string
                        enum: [daily, weekly, monthly]
                        default: daily
      responses:
        '200':
          description: Bulk operation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      successful:
                        type: array
                        items:
                          $ref: '#/components/schemas/Domain'
                      failed:
                        type: array
                        items:
                          type: object
                          properties:
                            domain:
                              type: string
                            error:
                              type: string
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/domains/bulk/retrieve:
    post:
      tags:
        - Domains
      summary: Bulk retrieve domain data
      description: Retrieve multiple domains by their IDs
      operationId: bulkRetrieveDomains
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - domainIds
              properties:
                domainIds:
                  type: array
                  maxItems: 100
                  items:
                    type: string
                    format: uuid
      responses:
        '200':
          description: Domains retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Domain'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # ==========================================
  # USER WEBHOOKS
  # ==========================================
  /api/v1/user-webhooks:
    get:
      tags:
        - User Webhooks
      summary: List webhook endpoints
      description: Get all registered webhook endpoints for the authenticated merchant
      operationId: listWebhookEndpoints
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Webhook endpoints retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/WebhookEndpoint'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - User Webhooks
      summary: Register webhook endpoint
      description: |
        Register a new webhook endpoint to receive domain event notifications.

        **Event Types:**
        - `domain.created` - Domain registered
        - `domain.updated` - Domain modified
        - `domain.deleted` - Domain removed
        - `domain.verified` - Domain verification successful
        - `domain.failed` - Domain verification failed
        - `domain.check.completed` - Periodic check completed

        **Subscribe to all events:** Omit the `events` field or set it to `null` to receive all events.
      operationId: createWebhookEndpoint
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
              properties:
                url:
                  type: string
                  format: uri
                  maxLength: 2048
                  example: https://your-app.com/webhooks/domain-monitor
                  description: HTTPS URL to receive webhook events
                events:
                  type: array
                  nullable: true
                  items:
                    type: string
                    enum:
                      - domain.created
                      - domain.updated
                      - domain.deleted
                      - domain.verified
                      - domain.failed
                      - domain.check.completed
                  example: ["domain.verified", "domain.failed"]
                  description: Event types to subscribe to. Omit or set to null to receive all events.
                description:
                  type: string
                  maxLength: 500
                  example: Production webhook endpoint
      responses:
        '201':
          description: Webhook endpoint created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Webhook endpoint created successfully
                  warning:
                    type: string
                    example: Store the secret securely. It will not be shown again.
                  data:
                    allOf:
                      - $ref: '#/components/schemas/WebhookEndpoint'
                      - type: object
                        properties:
                          secret:
                            type: string
                            example: whsec_abc123...
                            description: Webhook signing secret (only shown once)
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/user-webhooks/{id}:
    get:
      tags:
        - User Webhooks
      summary: Get webhook endpoint
      description: Retrieve details of a specific webhook endpoint
      operationId: getWebhookEndpoint
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Webhook endpoint retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/WebhookEndpoint'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    patch:
      tags:
        - User Webhooks
      summary: Update webhook endpoint
      description: Update webhook endpoint configuration
      operationId: updateWebhookEndpoint
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  format: uri
                events:
                  type: array
                  nullable: true
                  items:
                    type: string
                    enum:
                      - domain.created
                      - domain.updated
                      - domain.deleted
                      - domain.verified
                      - domain.failed
                      - domain.check.completed
                description:
                  type: string
                  maxLength: 500
                enabled:
                  type: boolean
      responses:
        '200':
          description: Webhook endpoint updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/WebhookEndpoint'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    delete:
      tags:
        - User Webhooks
      summary: Delete webhook endpoint
      description: Remove a webhook endpoint
      operationId: deleteWebhookEndpoint
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Webhook endpoint deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Webhook endpoint deleted successfully
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/user-webhooks/{id}/test:
    post:
      tags:
        - User Webhooks
      summary: Test webhook endpoint
      description: Send a test webhook to verify the endpoint is working
      operationId: testWebhookEndpoint
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Test webhook sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Test webhook sent successfully
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        example: success
                      responseStatus:
                        type: integer
                        example: 200
                      durationMs:
                        type: integer
                        example: 245
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/user-webhooks/{id}/regenerate-secret:
    post:
      tags:
        - User Webhooks
      summary: Regenerate webhook secret
      description: Generate a new signing secret for the webhook endpoint
      operationId: regenerateWebhookSecret
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Secret regenerated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Webhook secret regenerated successfully
                  warning:
                    type: string
                    example: Store the new secret securely. It will not be shown again.
                  data:
                    type: object
                    properties:
                      secret:
                        type: string
                        example: whsec_new123...
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/v1/user-webhooks/{id}/deliveries:
    get:
      tags:
        - User Webhooks
      summary: View webhook delivery logs
      description: Get delivery logs for a webhook endpoint
      operationId: getWebhookDeliveries
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Delivery logs retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/WebhookDelivery'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

# ==========================================
# COMPONENTS
# ==========================================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained from login endpoint

  schemas:
    Domain:
      type: object
      properties:
        id:
          type: string
          format: uuid
        domain:
          type: string
          example: example.com
        name:
          type: string
          example: My Business Website
        status:
          type: string
          enum: [active, inactive]
        recommendation:
          type: string
          enum: [pass, fail, review]
          nullable: true
        provider:
          type: string
          example: truebiz
        checkFrequency:
          type: string
          enum: [daily, weekly, monthly]
        lastCheckedAt:
          type: string
          format: date-time
          nullable: true
        nextCheckAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    WebhookEndpoint:
      type: object
      properties:
        id:
          type: string
          format: uuid
        url:
          type: string
          format: uri
          example: https://your-app.com/webhooks
        events:
          type: array
          nullable: true
          items:
            type: string
          example: ["domain.verified", "domain.failed"]
          description: Subscribed event types. null means all events.
        description:
          type: string
          nullable: true
        enabled:
          type: boolean
        lastDeliveryAt:
          type: string
          format: date-time
          nullable: true
        failedDeliveries:
          type: integer
          description: Consecutive failed delivery count
        totalDeliveries:
          type: integer
        successfulDeliveries:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    WebhookDelivery:
      type: object
      properties:
        id:
          type: string
          format: uuid
        eventType:
          type: string
          example: domain.verified
        domainId:
          type: string
          format: uuid
          nullable: true
        attemptNumber:
          type: integer
        status:
          type: string
          enum: [pending, success, failed, retrying]
        responseStatus:
          type: integer
          nullable: true
          example: 200
        durationMs:
          type: integer
          nullable: true
          example: 245
        errorMessage:
          type: string
          nullable: true
        sentAt:
          type: string
          format: date-time
          nullable: true
        completedAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        limit:
          type: integer
        offset:
          type: integer
        total:
          type: integer

    Error:
      type: object
      properties:
        message:
          type: string
        code:
          type: string
        details:
          type: object

  responses:
    UnauthorizedError:
      description: Authentication required or token invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Authentication required
            code: UNAUTHORIZED

    ValidationError:
      description: Validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Validation failed
            code: VALIDATION_ERROR
            details:
              email: Email is required

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Resource not found
            code: NOT_FOUND

security:
  - BearerAuth: []
