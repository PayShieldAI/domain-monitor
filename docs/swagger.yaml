openapi: 3.0.3
info:
  title: Domain Monitor API
  description: |
    Production-grade microservice for monitoring merchant web presence.

    ## Features
    - User authentication with JWT tokens
    - Domain monitoring with configurable check frequencies
    - Bulk operations support
    - Multi-provider architecture (TrueBiz primary)
    - Real-time updates via SSE (coming soon)
    - Webhook notifications (coming soon)

    ## Authentication
    Most endpoints require a Bearer token in the Authorization header:
    ```
    Authorization: Bearer <your_access_token>
    ```

    Get your token by calling `/api/v1/auth/login`.
  version: 1.0.0
  contact:
    name: API Support
    url: https://dev-domainmonitor.ipo-servers.net
  license:
    name: Proprietary

servers:
  - url: https://dev-domainmonitor.ipo-servers.net
    description: Development server
  - url: https://uat-domainmonitor.ipo-servers.net
    description: UAT server
  - url: https://domainmonitor.ipo-servers.net
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Authentication
    description: User authentication and authorization
  - name: Users
    description: User profile management
  - name: Domains
    description: Domain monitoring operations
  - name: Providers
    description: Provider management (Superadmin only)

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              example: VALIDATION_ERROR
            message:
              type: string
              example: Validation failed
            details:
              type: array
              items:
                type: object
                properties:
                  field:
                    type: string
                  message:
                    type: string

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        role:
          type: string
          enum: [superadmin, reseller, merchant]
        status:
          type: string
          enum: [active, inactive, pending_verification]
        emailVerifiedAt:
          type: string
          format: date-time
          nullable: true
        lastLoginAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Domain:
      type: object
      properties:
        id:
          type: string
          format: uuid
        domain:
          type: string
          example: example.com
        name:
          type: string
          nullable: true
          example: Example Corp
        status:
          type: string
          enum: [active, inactive]
        recommendation:
          type: string
          enum: [pass, fail, review]
          nullable: true
        industry:
          type: string
          nullable: true
        businessType:
          type: string
          nullable: true
        foundedYear:
          type: integer
          nullable: true
        provider:
          type: string
          nullable: true
        checkFrequency:
          type: string
          enum: [daily, weekly, monthly]
        lastCheckedAt:
          type: string
          format: date-time
          nullable: true
        nextCheckAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Provider:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: truebiz
        displayName:
          type: string
          example: TrueBiz API
        enabled:
          type: boolean
        priority:
          type: integer
          description: Lower value = higher priority
        apiBaseUrl:
          type: string
          format: uri
        apiKeyMasked:
          type: string
          example: sk_t****
        rateLimit:
          type: integer
          description: Requests per minute
        timeout:
          type: integer
          description: Timeout in milliseconds
        config:
          type: object
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer
        hasNext:
          type: boolean
        hasPrev:
          type: boolean

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check the health status of the API and database connection
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                  checks:
                    type: object
                    properties:
                      database:
                        type: string
                        example: ok
        '503':
          description: Service is degraded
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: degraded
                  checks:
                    type: object

  /api/v1/auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
                  pattern: '^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$'
                  description: Must contain uppercase, lowercase, and number
                name:
                  type: string
                role:
                  type: string
                  enum: [superadmin, reseller, merchant]
                  default: merchant
                  description: User role. Defaults to 'merchant' if not specified.
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      userId:
                        type: string
                        format: uuid
                      email:
                        type: string
                      name:
                        type: string
                      role:
                        type: string
                        enum: [superadmin, reseller, merchant]
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/auth/login:
    post:
      tags:
        - Authentication
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                      refreshToken:
                        type: string
                      expiresIn:
                        type: integer
                        example: 900
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                      refreshToken:
                        type: string
                      expiresIn:
                        type: integer
        '401':
          description: Invalid refresh token

  /api/v1/auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: Unauthorized

  /api/v1/auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: Request password reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Password reset email sent (if email exists)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /api/v1/auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset password with token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - password
              properties:
                token:
                  type: string
                password:
                  type: string
                  minLength: 8
                  pattern: '^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$'
      responses:
        '200':
          description: Password reset successful
        '400':
          description: Invalid or expired token

  /api/v1/auth/change-password:
    post:
      tags:
        - Authentication
      summary: Change password
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                newPassword:
                  type: string
                  minLength: 8
                  pattern: '^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$'
      responses:
        '200':
          description: Password changed successfully
        '400':
          description: Current password incorrect
        '401':
          description: Unauthorized

  /api/v1/users/me:
    get:
      tags:
        - Users
      summary: Get current user profile
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized

    patch:
      tags:
        - Users
      summary: Update current user profile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
        '409':
          description: Email already in use

  /api/v1/domains:
    get:
      tags:
        - Domains
      summary: List domains
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive]
        - name: recommendation
          in: query
          schema:
            type: string
            enum: [pass, fail, review]
        - name: search
          in: query
          schema:
            type: string
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [created_at, updated_at, domain, name, recommendation, last_checked_at]
            default: created_at
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: List of domains
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Domain'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                  filters:
                    type: object

    post:
      tags:
        - Domains
      summary: Add a domain
      description: |
        Add a domain or business to monitor. Either `domain` or `name` (business name) is required.

        Superadmins and resellers can optionally specify a `merchantId` to add domains on behalf of a merchant.

        Additional business information (address, contact details) can be provided for better matching.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                domain:
                  type: string
                  maxLength: 255
                  example: example.com
                  description: Domain name (required if name not provided)
                name:
                  type: string
                  maxLength: 255
                  example: "Bob's Burritos"
                  description: Business name (required if domain not provided)
                description:
                  type: string
                  maxLength: 1000
                  description: Business description
                website:
                  type: string
                  format: uri
                  maxLength: 500
                  description: Full website URL
                addressLine1:
                  type: string
                  maxLength: 255
                addressLine2:
                  type: string
                  maxLength: 255
                city:
                  type: string
                  maxLength: 100
                stateProvince:
                  type: string
                  maxLength: 100
                postalCode:
                  type: string
                  maxLength: 20
                country:
                  type: string
                  maxLength: 100
                email:
                  type: string
                  format: email
                  maxLength: 255
                  description: Contact email
                phone:
                  type: string
                  maxLength: 50
                  description: Contact phone
                fullName:
                  type: string
                  maxLength: 255
                  description: Contact person full name
                externalTrackingRef:
                  type: string
                  maxLength: 255
                  description: External tracking reference ID
                checkFrequency:
                  type: string
                  enum: [daily, weekly, monthly]
                  nullable: true
                  description: |
                    Monitoring frequency. If not provided (null/empty), no ongoing monitoring
                    will be started - only a one-time domain/company check is performed.
                merchantId:
                  type: string
                  format: uuid
                  description: |
                    (Superadmin/Reseller only) User ID of the merchant to add domain for.
                    If not provided, domain is added to the authenticated user's account.
      responses:
        '201':
          description: Domain added
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Domain'
        '409':
          description: Domain already exists
        '422':
          description: Validation error

  /api/v1/domains/bulk:
    post:
      tags:
        - Domains
      summary: Add multiple domains
      description: |
        Add multiple domains/businesses in a single request. Each item requires either `domain` or `name`.

        The response includes both creation results and provider check results.

        Superadmins and resellers can optionally specify a `merchantId` to add domains on behalf of a merchant.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - domains
              properties:
                domains:
                  type: array
                  minItems: 1
                  maxItems: 100
                  items:
                    type: object
                    properties:
                      domain:
                        type: string
                        maxLength: 255
                        description: Domain name (required if name not provided)
                      name:
                        type: string
                        maxLength: 255
                        description: Business name (required if domain not provided)
                      description:
                        type: string
                        maxLength: 1000
                      website:
                        type: string
                        format: uri
                        maxLength: 500
                      addressLine1:
                        type: string
                        maxLength: 255
                      addressLine2:
                        type: string
                        maxLength: 255
                      city:
                        type: string
                        maxLength: 100
                      stateProvince:
                        type: string
                        maxLength: 100
                      postalCode:
                        type: string
                        maxLength: 20
                      country:
                        type: string
                        maxLength: 100
                      email:
                        type: string
                        format: email
                        maxLength: 255
                      phone:
                        type: string
                        maxLength: 50
                      fullName:
                        type: string
                        maxLength: 255
                      externalTrackingRef:
                        type: string
                        maxLength: 255
                      checkFrequency:
                        type: string
                        enum: [daily, weekly, monthly]
                        nullable: true
                        description: |
                          Monitoring frequency. If not provided (null/empty), no ongoing monitoring
                          will be started - only a one-time domain/company check is performed.
                merchantId:
                  type: string
                  format: uuid
                  description: |
                    (Superadmin/Reseller only) User ID of the merchant to add domains for.
                    If not provided, domains are added to the authenticated user's account.
      responses:
        '201':
          description: Bulk operation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: array
                    description: Successfully created domains
                    items:
                      $ref: '#/components/schemas/Domain'
                  failed:
                    type: array
                    description: Domains that failed to create
                    items:
                      type: object
                      properties:
                        domain:
                          type: string
                        error:
                          type: string
                  total:
                    type: integer
                    description: Total domains in request
                  successCount:
                    type: integer
                    description: Number of successfully created domains
                  failedCount:
                    type: integer
                    description: Number of domains that failed to create
                  providerChecks:
                    type: object
                    description: Results of provider API checks for created domains
                    properties:
                      checked:
                        type: integer
                        description: Number of domains successfully checked by provider
                      failed:
                        type: integer
                        description: Number of domains where provider check failed
                      failures:
                        type: array
                        description: Details of failed provider checks
                        items:
                          type: object
                          properties:
                            domainId:
                              type: string
                              format: uuid
                            domain:
                              type: string
                            error:
                              type: string

  /api/v1/domains/bulk/retrieve:
    post:
      tags:
        - Domains
      summary: Retrieve multiple domains by IDs
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - ids
              properties:
                ids:
                  type: array
                  minItems: 1
                  maxItems: 100
                  items:
                    type: string
                    format: uuid
      responses:
        '200':
          description: Domains retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  domains:
                    type: array
                    items:
                      $ref: '#/components/schemas/Domain'
                  notFound:
                    type: array
                    items:
                      type: string

  /api/v1/domains/{id}:
    get:
      tags:
        - Domains
      summary: Get domain by ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Domain details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Domain'
        '404':
          description: Domain not found

  /api/v1/domains/{id}/details:
    get:
      tags:
        - Domains
      summary: Get domain with full raw data
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Domain details with raw data
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    allOf:
                      - $ref: '#/components/schemas/Domain'
                      - type: object
                        properties:
                          rawData:
                            type: object
                          providerResponseId:
                            type: string

  /api/v1/domains/{id}/history:
    get:
      tags:
        - Domains
      summary: Get domain check history
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            maximum: 100
      responses:
        '200':
          description: Check history
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        recommendation:
                          type: string
                        provider:
                          type: string
                        checkedAt:
                          type: string
                          format: date-time

  /api/v1/domains/{id}/stop:
    patch:
      tags:
        - Domains
      summary: Stop monitoring domain
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Monitoring stopped
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Domain'

  /api/v1/domains/{id}/start:
    patch:
      tags:
        - Domains
      summary: Start monitoring domain
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Monitoring started
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Domain'

  /api/v1/domains/bulk/stop:
    patch:
      tags:
        - Domains
      summary: Stop monitoring multiple domains
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - ids
              properties:
                ids:
                  type: array
                  minItems: 1
                  maxItems: 100
                  items:
                    type: string
                    format: uuid
      responses:
        '200':
          description: Bulk stop result
          content:
            application/json:
              schema:
                type: object
                properties:
                  updated:
                    type: array
                    items:
                      type: string
                  notFound:
                    type: array
                    items:
                      type: string
                  message:
                    type: string

  /api/v1/domains/bulk/start:
    patch:
      tags:
        - Domains
      summary: Start monitoring multiple domains
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - ids
              properties:
                ids:
                  type: array
                  minItems: 1
                  maxItems: 100
                  items:
                    type: string
                    format: uuid
      responses:
        '200':
          description: Bulk start result
          content:
            application/json:
              schema:
                type: object
                properties:
                  updated:
                    type: array
                    items:
                      type: string
                  notFound:
                    type: array
                    items:
                      type: string
                  message:
                    type: string

  /api/v1/admin/providers:
    get:
      tags:
        - Providers
      summary: List all providers
      description: Get all providers with their configuration (API keys masked). Requires superadmin role.
      security:
        - BearerAuth: []
      parameters:
        - name: enabled
          in: query
          schema:
            type: boolean
          description: Filter by enabled status
      responses:
        '200':
          description: List of providers
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Provider'
        '401':
          description: Unauthorized
        '403':
          description: Superadmin access required

    post:
      tags:
        - Providers
      summary: Create a new provider
      description: Create a new provider with encrypted API key. Requires superadmin role.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - displayName
                - apiBaseUrl
                - apiKey
              properties:
                name:
                  type: string
                  pattern: '^[a-z0-9_-]+$'
                  minLength: 2
                  maxLength: 50
                  example: truebiz
                displayName:
                  type: string
                  minLength: 2
                  maxLength: 100
                  example: TrueBiz API
                apiBaseUrl:
                  type: string
                  format: uri
                  example: https://api.truebiz.com/v1
                apiKey:
                  type: string
                  minLength: 10
                  maxLength: 500
                  example: sk_test_123456789
                enabled:
                  type: boolean
                  default: true
                priority:
                  type: integer
                  minimum: 1
                  maximum: 1000
                  default: 100
                rateLimit:
                  type: integer
                  minimum: 1
                  maximum: 10000
                  default: 60
                timeout:
                  type: integer
                  minimum: 1000
                  maximum: 60000
                  default: 10000
                config:
                  type: object
      responses:
        '201':
          description: Provider created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Provider'
        '409':
          description: Provider already exists
        '422':
          description: Validation error

  /api/v1/admin/providers/{id}:
    get:
      tags:
        - Providers
      summary: Get provider by ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Provider details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Provider'
        '404':
          description: Provider not found

    patch:
      tags:
        - Providers
      summary: Update provider
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              minProperties: 1
              properties:
                displayName:
                  type: string
                apiBaseUrl:
                  type: string
                  format: uri
                apiKey:
                  type: string
                enabled:
                  type: boolean
                priority:
                  type: integer
                rateLimit:
                  type: integer
                timeout:
                  type: integer
                config:
                  type: object
      responses:
        '200':
          description: Provider updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Provider'
        '404':
          description: Provider not found

    delete:
      tags:
        - Providers
      summary: Delete provider
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Provider deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '404':
          description: Provider not found

  /api/v1/admin/providers/name/{name}:
    get:
      tags:
        - Providers
      summary: Get provider by name
      security:
        - BearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
            pattern: '^[a-z0-9_-]+$'
          example: truebiz
      responses:
        '200':
          description: Provider details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Provider'
        '404':
          description: Provider not found

  /api/v1/admin/providers/{id}/enable:
    patch:
      tags:
        - Providers
      summary: Enable provider
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Provider enabled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Provider'

  /api/v1/admin/providers/{id}/disable:
    patch:
      tags:
        - Providers
      summary: Disable provider
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Provider disabled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Provider'

  /api/v1/admin/providers/{id}/priority:
    patch:
      tags:
        - Providers
      summary: Update provider priority
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - priority
              properties:
                priority:
                  type: integer
                  minimum: 1
                  maximum: 1000
      responses:
        '200':
          description: Priority updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Provider'

  /api/v1/admin/providers/reload:
    post:
      tags:
        - Providers
      summary: Reload providers from database
      description: Reloads all providers from database into memory. Use after manual database changes.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Providers reloaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      count:
                        type: integer
                        description: Number of providers loaded
                      providers:
                        type: array
                        items:
                          type: string
                        description: List of provider names

  /api/v1/admin/providers/{id}/health:
    get:
      tags:
        - Providers
      summary: Check provider health
      description: Check if provider API is reachable and responding
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Health check result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        enum: [ok, error]
                      provider:
                        type: string
                      error:
                        type: string
                        nullable: true
                      responseTime:
                        type: integer
                        description: Response time in milliseconds
