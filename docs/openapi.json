{
  "openapi": "3.0.3",
  "info": {
    "title": "Domain Monitor API - Merchant Portal",
    "description": "Merchant-focused API for domain monitoring and verification.\n\n## Overview\nThis API allows merchants to monitor their domain reputation and verification status.\nAll endpoints use JWT Bearer token authentication \n\n## Authentication\nAll endpoints require JWT authentication.\n\n```\nAuthorization: Bearer <your_access_token>\n```\n",
    "version": "1.0.0",
    "contact": {
      "email": "support@domainmonitor.com"
    }
  },
  "servers": [
    {
      "url": "https://dev-domainmonitor.ipo-servers.net",
      "description": "Development server"
    },
    {
      "url": "https://api.domainmonitor.com",
      "description": "Production server"
    },
    {
      "url": "https://justin-dev-domainmonitor.ipo-servers.net",
      "description": "Justin Development server"
    }
  ],
  "tags": [
    {
      "name": "Domains",
      "description": "Domain monitoring and management"
    },
    {
      "name": "User Webhooks",
      "description": "Register webhooks to receive domain event notifications\n\n## Webhook Security\n\nAll webhooks sent by Domain Monitor include a cryptographic signature that you should verify to ensure the webhook is authentic and hasn't been tampered with.\n\n### Signature Verification\n\nEach webhook request includes the following headers:\n- `X-Webhook-Signature`: HMAC-SHA256 signature in the format `sha256={hex_digest}`\n- `X-Webhook-Event`: The event type (e.g., `business-closed`, `sentiment`)\n- `X-Webhook-Delivery-Id`: Unique delivery ID for tracking\n- `User-Agent`: Always `DomainMonitor-Webhook/1.0`\n\n### How to Verify the Signature\n\n1. Retrieve the signing secret for your webhook endpoint (provided when you register or regenerate the secret)\n2. Get the raw request body as a string\n3. Compute the HMAC-SHA256 signature:\n   - Use your webhook secret as the key\n   - Hash the raw JSON request body (as received, without parsing)\n   - Format the result as `sha256={hex_digest}`\n4. Compare your computed signature with the `X-Webhook-Signature` header using a timing-safe comparison\n\n### Example Verification Code\n\n**Node.js:**\n```javascript\nconst crypto = require('crypto');\n\nfunction verifyWebhookSignature(payload, signature, secret) {\n  const hmac = crypto.createHmac('sha256', secret);\n  hmac.update(JSON.stringify(payload));\n  const expectedSignature = `sha256=${hmac.digest('hex')}`;\n\n  // Use timing-safe comparison to prevent timing attacks\n  return crypto.timingSafeEqual(\n    Buffer.from(signature),\n    Buffer.from(expectedSignature)\n  );\n}\n\n// Express.js example\napp.post('/webhooks', express.json(), (req, res) => {\n  const signature = req.headers['x-webhook-signature'];\n  const secret = process.env.WEBHOOK_SECRET; // Your webhook secret\n\n  if (!verifyWebhookSignature(req.body, signature, secret)) {\n    return res.status(401).send('Invalid signature');\n  }\n\n  // Process webhook event\n  const eventType = req.headers['x-webhook-event'];\n  console.log('Received event:', eventType, req.body);\n\n  res.status(200).send('OK');\n});\n```\n\n**Python:**\n```python\nimport hmac\nimport hashlib\nimport json\n\ndef verify_webhook_signature(payload, signature, secret):\n    expected_signature = 'sha256=' + hmac.new(\n        secret.encode('utf-8'),\n        json.dumps(payload, separators=(',', ':')).encode('utf-8'),\n        hashlib.sha256\n    ).hexdigest()\n\n    return hmac.compare_digest(signature, expected_signature)\n\n# Flask example\n@app.route('/webhooks', methods=['POST'])\ndef handle_webhook():\n    signature = request.headers.get('X-Webhook-Signature')\n    secret = os.environ.get('WEBHOOK_SECRET')\n\n    if not verify_webhook_signature(request.json, signature, secret):\n        return 'Invalid signature', 401\n\n    event_type = request.headers.get('X-Webhook-Event')\n    print(f'Received event: {event_type}', request.json)\n\n    return 'OK', 200\n```\n\n### Important Security Notes\n\n- **Always verify the signature** before processing webhook data\n- Use a **timing-safe comparison** function to prevent timing attacks\n- Store your webhook secret securely (environment variables, secrets manager)\n- If your secret is compromised, regenerate it immediately using the `/api/v1/user-webhooks/{id}/regenerate-secret` endpoint\n- Webhook requests timeout after 10 seconds\n- Failed deliveries are retried up to 3 times (after 1 min, 5 min, 15 min)\n- Return a 2xx status code within 10 seconds to acknowledge receipt\n"
    }
  ],
  "paths": {
    "/api/v1/domains": {
      "get": {
        "tags": [
          "Domains"
        ],
        "summary": "List all domains",
        "description": "Get a list of all domains belonging to the authenticated merchant",
        "operationId": "listDomains",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "inactive"
              ]
            },
            "description": "Filter by domain status"
          },
          {
            "name": "recommendation",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "pass",
                "fail",
                "review"
              ]
            },
            "description": "Filter by recommendation status"
          },
          {
            "name": "industry",
            "in": "query",
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Filter by industry"
          },
          {
            "name": "businessType",
            "in": "query",
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Filter by business type"
          },
          {
            "name": "foundedYear",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1800
            },
            "description": "Filter by founded year"
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string",
              "maxLength": 255
            },
            "description": "Search by domain or name"
          },
          {
            "name": "sortBy",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "created_at",
                "updated_at",
                "domain",
                "name",
                "recommendation",
                "last_checked_at",
                "industry",
                "business_type",
                "founded_year"
              ],
              "default": "created_at"
            },
            "description": "Field to sort by"
          },
          {
            "name": "sortOrder",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            },
            "description": "Sort order"
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1,
              "minimum": 1
            },
            "description": "Page number"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20,
              "maximum": 100
            },
            "description": "Number of items per page"
          }
        ],
        "responses": {
          "200": {
            "description": "Domains retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Domains retrieved successfully"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Domain"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/Pagination"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      },
      "post": {
        "tags": [
          "Domains"
        ],
        "summary": "Add a new domain",
        "description": "Register a new domain for monitoring",
        "operationId": "createDomain",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "domain"
                ],
                "properties": {
                  "domain": {
                    "type": "string",
                    "example": "example.com",
                    "description": "Domain name without protocol"
                  },
                  "name": {
                    "type": "string",
                    "example": "My Business Website",
                    "description": "Friendly name for the domain"
                  },
                  "checkFrequency": {
                    "type": "string",
                    "enum": [
                      "7",
                      "30",
                      "90"
                    ],
                    "default": "7",
                    "description": "Monitoring frequency in days:\n- '7': Weekly monitoring (every 7 days)\n- '30': Monthly monitoring (every 30 days)\n- '90': Quarterly monitoring (every 90 days)\n\nThis value is sent to the monitoring provider to configure the monitoring package frequency.\n"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Domain created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Domain created and verification initiated"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Domain"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "409": {
            "description": "Domain already exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/domains/{id}": {
      "get": {
        "tags": [
          "Domains"
        ],
        "summary": "Get domain by ID",
        "description": "Retrieve detailed information about a specific domain",
        "operationId": "getDomainById",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Domain retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Domain"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      }
    },
    "/api/v1/domains/{id}/details": {
      "get": {
        "tags": [
          "Domains"
        ],
        "summary": "Get domain verification details with raw provider data",
        "description": "Get comprehensive verification details including the complete raw response from the provider.\n\n**Important:** This endpoint returns the full raw JSON response from the verification provider\nin the `web_presence.rawData` field. This includes all data points collected during the\nweb presence review.\n",
        "operationId": "getDomainDetails",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Domain details with raw provider data retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "allOf": [
                        {
                          "$ref": "#/components/schemas/Domain"
                        },
                        {
                          "type": "object",
                          "properties": {
                            "web_presence": {
                              "type": "object",
                              "properties": {
                                "recommendation": {
                                  "type": "string",
                                  "enum": [
                                    "pass",
                                    "fail",
                                    "review"
                                  ]
                                },
                                "businessName": {
                                  "type": "string"
                                },
                                "industry": {
                                  "type": "string"
                                },
                                "businessType": {
                                  "type": "string"
                                },
                                "foundedYear": {
                                  "type": "integer"
                                },
                                "provider": {
                                  "type": "string"
                                },
                                "rawData": {
                                  "type": "object",
                                  "description": "Complete raw JSON response from the verification provider",
                                  "nullable": true
                                },
                                "providerResponseId": {
                                  "type": "string",
                                  "description": "Provider's unique response/transaction ID",
                                  "nullable": true
                                }
                              }
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      }
    },
    "/api/v1/domains/{id}/stop": {
      "patch": {
        "tags": [
          "Domains"
        ],
        "summary": "Stop monitoring domain",
        "description": "Pause monitoring for this domain",
        "operationId": "stopDomain",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Domain monitoring stopped",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Domain monitoring stopped"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      }
    },
    "/api/v1/domains/{id}/start": {
      "patch": {
        "tags": [
          "Domains"
        ],
        "summary": "Start monitoring domain",
        "description": "Resume monitoring for this domain",
        "operationId": "startDomain",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Domain monitoring started",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Domain monitoring started"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      }
    },
    "/api/v1/user-webhooks": {
      "get": {
        "tags": [
          "User Webhooks"
        ],
        "summary": "List webhook endpoints",
        "description": "Get all registered webhook endpoints for the authenticated merchant",
        "operationId": "listWebhookEndpoints",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Webhook endpoints retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/WebhookEndpoint"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/api/v1/user-webhooks/{id}": {
      "get": {
        "tags": [
          "User Webhooks"
        ],
        "summary": "Get webhook endpoint",
        "description": "Retrieve details of a specific webhook endpoint",
        "operationId": "getWebhookEndpoint",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Webhook endpoint retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "$ref": "#/components/schemas/WebhookEndpoint"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      },
      "patch": {
        "tags": [
          "User Webhooks"
        ],
        "summary": "Update webhook endpoint",
        "description": "Update webhook endpoint configuration",
        "operationId": "updateWebhookEndpoint",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "url": {
                    "type": "string",
                    "format": "uri"
                  },
                  "events": {
                    "type": "array",
                    "nullable": true,
                    "items": {
                      "type": "string",
                      "enum": [
                        "domain.created",
                        "business-profile",
                        "domain.deleted",
                        "business-closed",
                        "sentiment",
                        "website"
                      ]
                    }
                  },
                  "description": {
                    "type": "string",
                    "maxLength": 500
                  },
                  "enabled": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Webhook endpoint updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "$ref": "#/components/schemas/WebhookEndpoint"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      }
    },
    "/api/v1/user-webhooks/{id}/test": {
      "post": {
        "tags": [
          "User Webhooks"
        ],
        "summary": "Test webhook endpoint",
        "description": "Send a test webhook to verify the endpoint is working",
        "operationId": "testWebhookEndpoint",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Test webhook sent",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Test webhook sent successfully"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "string",
                          "example": "success"
                        },
                        "responseStatus": {
                          "type": "integer",
                          "example": 200
                        },
                        "durationMs": {
                          "type": "integer",
                          "example": 245
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      }
    },
    "/api/v1/user-webhooks/{id}/regenerate-secret": {
      "post": {
        "tags": [
          "User Webhooks"
        ],
        "summary": "Regenerate webhook secret",
        "description": "Generate a new signing secret for the webhook endpoint",
        "operationId": "regenerateWebhookSecret",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Secret regenerated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Webhook secret regenerated successfully"
                    },
                    "warning": {
                      "type": "string",
                      "example": "Store the new secret securely. It will not be shown again."
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "secret": {
                          "type": "string",
                          "example": "new123..."
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      }
    },
    "/api/v1/user-webhooks/{id}/deliveries": {
      "get": {
        "tags": [
          "User Webhooks"
        ],
        "summary": "View webhook delivery logs",
        "description": "Get delivery logs for a webhook endpoint",
        "operationId": "getWebhookDeliveries",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 50,
              "maximum": 100
            }
          },
          {
            "name": "offset",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Delivery logs retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/WebhookDelivery"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "$ref": "#/components/responses/NotFoundError"
          }
        }
      }
    },
    "/api/v1/user-webhooks/deliveries": {
      "get": {
        "tags": [
          "User Webhooks"
        ],
        "summary": "List all delivery logs",
        "description": "Get all webhook delivery logs for your account with optional filters.\n\nReturns delivery logs across all your webhook endpoints.\n",
        "operationId": "listAllDeliveries",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1,
              "minimum": 1
            },
            "description": "Page number"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 100,
              "minimum": 1,
              "maximum": 1000
            },
            "description": "Number of items per page"
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "success",
                "failed",
                "retrying"
              ]
            },
            "description": "Filter by delivery status"
          }
        ],
        "responses": {
          "200": {
            "description": "Delivery logs retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Delivery logs retrieved successfully"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "allOf": [
                          {
                            "$ref": "#/components/schemas/WebhookDelivery"
                          },
                          {
                            "type": "object",
                            "properties": {
                              "endpointId": {
                                "type": "string",
                                "format": "uuid"
                              },
                              "endpointUrl": {
                                "type": "string",
                                "format": "uri"
                              }
                            }
                          }
                        ]
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/Pagination"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT access token obtained from login endpoint"
      }
    },
    "schemas": {
      "Domain": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "domain": {
            "type": "string",
            "example": "example.com"
          },
          "name": {
            "type": "string",
            "example": "My Business Website"
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "inactive"
            ]
          },
          "recommendation": {
            "type": "string",
            "enum": [
              "pass",
              "fail",
              "review"
            ],
            "nullable": true
          },
          "provider": {
            "type": "string",
            "example": "truebiz"
          },
          "checkFrequency": {
            "type": "string",
            "enum": [
              "7",
              "30",
              "90"
            ],
            "description": "Monitoring frequency in days:\n- '7': Weekly monitoring (every 7 days)\n- '30': Monthly monitoring (every 30 days)\n- '90': Quarterly monitoring (every 90 days)\n\nThis value is sent to the monitoring provider (e.g., TrueBiz) to configure the monitoring package frequency.\n"
          },
          "lastCheckedAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "nextCheckAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "WebhookEndpoint": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "example": "https://your-app.com/webhooks"
          },
          "events": {
            "type": "array",
            "nullable": true,
            "items": {
              "type": "string"
            },
            "example": [
              "business-closed",
              "sentiment"
            ],
            "description": "Subscribed event types. null means all events."
          },
          "description": {
            "type": "string",
            "nullable": true
          },
          "enabled": {
            "type": "boolean"
          },
          "lastDeliveryAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "failedDeliveries": {
            "type": "integer",
            "description": "Consecutive failed delivery count"
          },
          "totalDeliveries": {
            "type": "integer"
          },
          "successfulDeliveries": {
            "type": "integer"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "WebhookDelivery": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "eventType": {
            "type": "string",
            "example": "business-closed"
          },
          "domainId": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "attemptNumber": {
            "type": "integer"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "success",
              "failed",
              "retrying"
            ]
          },
          "responseStatus": {
            "type": "integer",
            "nullable": true,
            "example": 200
          },
          "durationMs": {
            "type": "integer",
            "nullable": true,
            "example": 245
          },
          "errorMessage": {
            "type": "string",
            "nullable": true
          },
          "sentAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "completedAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "WebhookEvent": {
        "type": "object",
        "description": "Webhook event payload sent to your endpoint.\n\n**Important:** Always verify the `X-Webhook-Signature` header before processing this payload.\n",
        "properties": {
          "event": {
            "type": "string",
            "description": "The event type",
            "enum": [
              "domain.created",
              "business-profile",
              "domain.deleted",
              "business-closed",
              "sentiment",
              "website",
              "webhook.test"
            ],
            "example": "business-closed"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When the event occurred",
            "example": "2024-01-15T10:30:00Z"
          },
          "data": {
            "type": "object",
            "description": "Event-specific data",
            "properties": {
              "domainId": {
                "type": "string",
                "format": "uuid",
                "description": "The domain ID (present for domain-related events)"
              },
              "domain": {
                "type": "string",
                "description": "The domain name",
                "example": "example.com"
              },
              "recommendation": {
                "type": "string",
                "enum": [
                  "pass",
                  "fail",
                  "review"
                ],
                "description": "The verification recommendation"
              },
              "message": {
                "type": "string",
                "description": "Human-readable event description"
              }
            },
            "additionalProperties": true
          }
        },
        "required": [
          "event",
          "timestamp",
          "data"
        ],
        "example": {
          "event": "business-closed",
          "timestamp": "2024-01-15T10:30:00Z",
          "data": {
            "domainId": "123e4567-e89b-12d3-a456-426614174000",
            "domain": "example.com",
            "recommendation": "fail",
            "message": "Business appears to be closed based on verification data"
          }
        }
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          }
        }
      },
      "Error": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          },
          "code": {
            "type": "string"
          },
          "details": {
            "type": "object"
          }
        }
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Authentication required or token invalid",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "message": "Authentication required",
              "code": "UNAUTHORIZED"
            }
          }
        }
      },
      "ValidationError": {
        "description": "Validation failed",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "message": "Validation failed",
              "code": "VALIDATION_ERROR",
              "details": {
                "email": "Email is required"
              }
            }
          }
        }
      },
      "NotFoundError": {
        "description": "Resource not found",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "message": "Resource not found",
              "code": "NOT_FOUND"
            }
          }
        }
      }
    }
  },
  "security": [
    {
      "BearerAuth": []
    }
  ]
}